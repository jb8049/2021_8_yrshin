<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spending.SpendingDAO">


	
<!-- 	<resultMap type="transactionHistoryVO" id="transactionHistoryMap">
		<result column="transaction_no" property="transactionNo"/>
		<result column="transaction_code" property="transCode"/>
		<result column="my_acc_no" property="myAccNo"/>
		<result column="trans_money" property="transMoney"/>
		<result column="balance" property="balance"/>
		<result column="transaction_info" property="transInfo"/>
		<result column="others_name" property="othersName"/>
		<result column="transaction_date" property="transDate"/>
		<result column="category" property="category"/>
	</resultMap> -->
	
<!-- 	<resultMap type="kr.ac.kopo.spending.vo.SpendingInfoVO" id="spendingInfoMap">
		<result column="account_no" property="accountNo"/>
		<result column="" property=""/>
	</resultMap> -->
	
<!-- 	<select id="spendingByCategory" parameterType="string" resultMap="transactionHistoryMap">
		select category, -sum(trans_money) as trans_money
			from tbl_transaction_history
			where my_acc_no='081000000010' and to_char(transaction_date, 'yy/mm') = '21/09'
			and transaction_code = '11005'
		group by category
	</select> -->
	
	<resultMap type="calendarVO" id="calendarMap">
		<result column="start_date" property="start" />
		<result column="title" property="title" />
		<result column="color" property="color" />
	</resultMap> 
	
	<!-- 캘린더 날짜 별 소비 -->
	<select id="spendingByDate" parameterType="string" resultMap="calendarMap">
		select to_char(transaction_date, 'yyyy-mm-dd') as start_date, sum(trans_money) as title
				from tbl_transaction_history where my_acc_no='081000000010' <![CDATA[ and trans_money < 0]]>
		group by to_char(transaction_date, 'yyyy-mm-dd')
	</select>
	
	<!-- 캘린더 날짜 별 수입 -->
	<select id="incomeByDate" parameterType="string" resultMap="calendarMap">
		select to_char(transaction_date, 'yyyy-mm-dd') as start_date, '+'||sum(trans_money) as title
				from tbl_transaction_history where my_acc_no='081000000010' <![CDATA[ and  trans_money > 0]]>
		group by to_char(transaction_date, 'yyyy-mm-dd')
	</select>

	<!-- 월 별 카테고리 별 사용금액 -->
	<select id="spendingByCategory" parameterType="spendingInfoVO" resultType="spendingInfoVO">
		select  nvl(category , '기타') as category, -sum(trans_money) as spendingMoney
			from tbl_transaction_history
			where my_acc_no=#{accountNo} and to_char(transaction_date, 'yyyymm') = #{yearMonth}
			and transaction_code = '11005'
		group by category order by spendingMoney desc
	</select>
	
	
	<!-- 월 별 top3 소비 카테고리 -->	
	<select id="topSpending" parameterType="spendingInfoVO" resultType="string">
		select category from
		(select category, -sum(trans_money) as spendingMoney
			from tbl_transaction_history
			where my_acc_no=#{accountNo} and to_char(transaction_date, 'yyyymm') = #{yearMonth}
			and transaction_code = '11005'
		group by category order by spendingMoney desc)
		<![CDATA[where rownum <= 3]]>
	</select>
	
	
	
</mapper>
